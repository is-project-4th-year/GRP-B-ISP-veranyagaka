{% extends "base.html" %}
{% block content %}
<h2>Login</h2>

<form method="post">
  {% csrf_token %}
  <input type="email" name="email" placeholder="Email" required>
  <input type="password" name="password" placeholder="Password" required>
  <button type="submit">Login</button>
</form>

<hr>
<button id="google-login" class="google-btn">Login with Google</button>
<button id="test" class="test">Test button</button>


<!-- ‚úÖ Use ES module syntax -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC5_JGhGc86S9op8MAlAW1O7-SgDaJ8eZQ",
    authDomain: "srcnn-1ae4b.firebaseapp.com",
    projectId: "srcnn-1ae4b",
    storageBucket: "srcnn-1ae4b.firebasestorage.app",
    messagingSenderId: "148880112523",
    appId: "1:148880112523:web:7289b1f0d3ae0a817b4d8e",
    measurementId: "G-5Y6E6TRC0W"
  };

  // ‚úÖ Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  document.getElementById("test").addEventListener("click", () => {
    console.log("‚úÖ Test clicked");
  });

  document.getElementById("google-login").addEventListener("click", async () => {
    console.log("üü¢ Google Login clicked");

    try {
      const result = await signInWithPopup(auth, provider);
      const token = await result.user.getIdToken();

      const response = await fetch("/api/auth/login/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}"
        },
        body: JSON.stringify({ token })
      });

      if (response.ok) {
        console.log("‚úÖ Login success, redirecting...");
        window.location.href = "/dashboard/";
      } else {
        alert("Google login failed ‚ùå");
      }
    } catch (error) {
      console.error("üö® Google login failed:", error);
    }
  });
</script>

{% endblock %}
